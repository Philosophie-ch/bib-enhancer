{
  "https://www.unifr.ch/philosophie/de/forschung/habilitationen.html": {
    "site_name": "UniFR Philosophy - Habilitationen",
    "description": "Habilitation theses from University of Fribourg Philosophy Department",
    "expected_count": 24,
    "last_extraction": "2025-10-29",
    "site_characteristics": {
      "type": "static_html",
      "structure": "Simple HTML page with structured thesis listings",
      "javascript_required": false,
      "pagination": false
    },
    "extraction_method": {
      "approach": "Direct HTML parsing with fetch_url_text()",
      "steps": [
        "Fetch page content using fetch_url_text() from web_scraper",
        "Parse HTML to identify thesis entries (organized by category: Antike Philosophie, Philosophie des Mittelalters, etc.)",
        "Each entry contains: Author name, Year, Thesis title, Committee members",
        "Extract year from text following author name (format: 'Name, Year')",
        "Create RawWebTextBibitem with type='thesis'"
      ],
      "challenges": [],
      "notes": "Straightforward static page. Years and titles are clearly structured."
    },
    "output_format": {
      "file": "habilitationen_unifr.csv",
      "location": "./data/test-2/"
    },
    "sample_entry": {
      "raw_text": "Luca Pitteloud, 2021\nOrdre et désordre dans l'univers. Une étude sur l'expérience de pensée du Timée.\nProf. Filip Karfík (Fribourg), Prof. Dimitri El Murr (École normale supérieure, Paris), Prof. Franco Ferrari (Università di Pavia)",
      "type": "thesis",
      "title": "Ordre et désordre dans l'univers. Une étude sur l'expérience de pensée du Timée",
      "year": 2021,
      "authors": [{"given": "Luca", "family": "Pitteloud"}]
    }
  },

  "https://www.fr.ch/bcu/app/master_cat": {
    "site_name": "Fribourg University Master Catalogue",
    "description": "Central catalogue for theses, mémoires, and master works from University of Fribourg",
    "url_parameters": {
      "f_faculty": "2 = Faculty of Letters",
      "f_document": "1 = Doctoral theses (Thèses)",
      "f_subject_category": "40 = Philosophie"
    },
    "expected_count": 466,
    "last_extraction": "2025-10-29",
    "site_characteristics": {
      "type": "dynamic_api",
      "structure": "Drupal-based site with AJAX-loaded results",
      "javascript_required": true,
      "pagination": true,
      "items_per_page": 10
    },
    "extraction_method": {
      "approach": "POST to API endpoint with form parameters",
      "api_endpoint": "https://www.fr.ch/app/master_cat/get_results",
      "http_method": "POST",
      "parameters": {
        "form[f_faculty]": "2",
        "form[f_document]": "1",
        "form[f_subject_category]": "40",
        "page": "1"
      },
      "steps": [
        "Send POST request to /app/master_cat/get_results",
        "Use form[parameter] format (NOT URL query parameters)",
        "Server returns JSON with 'html' and 'pager' keys",
        "Parse HTML to extract list items (<li class='element-list'>)",
        "Extract: item ID (hidden input), title (h2), author (p.list__item__description), classification, year",
        "Paginate through all pages (~47 pages for 466 items)",
        "Create RawWebTextBibitem objects for each entry"
      ],
      "challenges": [
        {
          "issue": "URL parameters ignored",
          "description": "Initially tried GET with f_faculty=2&f_document=1&f_subject_category=40 in URL. API returned all 31,882 unfiltered results.",
          "solution": "Must use POST with form[parameter] format. Server filters results server-side when form data is correct."
        },
        {
          "issue": "Confusing result count",
          "description": "Browser showed '466 résultats trouvés' but API returned 31,882 results with GET requests.",
          "solution": "Browser's JavaScript sends POST with form parameters. GET parameters don't work for filtering."
        },
        {
          "issue": "Attempted detail page fetching",
          "description": "Initially thought we needed to fetch each item's detail page to check Sujets (subjects) field for 'Philosophie'.",
          "solution": "Unnecessary when using correct POST parameters. Server pre-filters results."
        }
      ],
      "notes": [
        "The Drupal site loads results via AJAX using DataTables-style requests",
        "Form parameter format is critical: 'form[f_subject_category]' not 'f_subject_category'",
        "Server-side filtering works perfectly when parameters are correct",
        "Extraction completes in ~2 minutes (47 pages × 0.2s delay = 9.4s + processing)"
      ]
    },
    "discovery_process": {
      "attempts": [
        "1. GET with URL parameters → 31,882 unfiltered results",
        "2. Fetching detail pages one-by-one to check Sujets field → Too slow (hours), only found 43/466 in first 100 pages",
        "3. Analyzed browser JavaScript → Found DataTables with form parameter format",
        "4. POST with form[parameter] format → SUCCESS! Got exactly 466 filtered results"
      ],
      "key_insight": "Browser shows correct count because JavaScript converts filter selections to POST form data. API ignores GET parameters entirely."
    },
    "output_format": {
      "file": "philosophy_theses_466.csv",
      "location": "./data/test-2/"
    },
    "sample_entry": {
      "raw_text": "\"Das Eine, was der Menschheit Noth ist\" : Einheit und Freiheit in der Philosophie Karl Leonhard Reinholds (1789-1792) / Alessandro Lazzari\nLazzari, Alessandro\nLieu, Année : Stuttgart-Bad Cannstatt : Frommann-Holzboog, 2004\nPhilosophie\nTHFR FACLET 2000",
      "type": "thesis",
      "title": "\"Das Eine, was der Menschheit Noth ist\" : Einheit und Freiheit in der Philosophie Karl Leonhard Reinholds (1789-1792)",
      "year": 2000,
      "authors": [{"given": "Alessandro", "family": "Lazzari"}],
      "publisher": "Frommann-Holzboog"
    },
    "related_queries": {
      "memoires_licence": {
        "description": "License memoirs in Philosophy",
        "form[f_document]": "2",
        "expected_count": 587
      },
      "travaux_master": {
        "description": "Master's theses in Philosophy",
        "form[f_document]": "3",
        "expected_count": 61
      }
    }
  },

  "https://www.unil.ch/philo/fr/home/menuinst/recherches/memoires.html": {
    "site_name": "UNIL Philosophy - Mémoires",
    "description": "Master's memoirs from University of Lausanne (UNIL) Philosophy Section",
    "expected_count": "19 (2024 only, ~300+ total across all years 2010-2024)",
    "last_extraction": "2025-10-29",
    "site_characteristics": {
      "type": "static_html",
      "structure": "Simple HTML page with year-organized memoir listings",
      "javascript_required": false,
      "pagination": false,
      "years_available": "2010-2024"
    },
    "extraction_method": {
      "approach": "Direct HTML parsing with fetch_url_text()",
      "steps": [
        "Fetch page content using fetch_url_text() from web_scraper",
        "Parse HTML to identify memoir entries organized by year (2024, 2023, 2022, etc.)",
        "Each entry contains: Author name, Title, Month/Year, Director name",
        "Format: 'LASTNAME Firstname : Title. Month Year\\nDirecteur/Directrice : Director Name'",
        "Extract year from date line (format: 'Janvier 2024', 'Juin 2024', etc.)",
        "Extract supervisor from 'Directeur' or 'Directrice' line",
        "Create RawWebTextBibitem with type='mastersthesis'"
      ],
      "challenges": [],
      "notes": [
        "Straightforward static page with clear structure",
        "Years and titles are clearly formatted",
        "Author names in UPPERCASE LASTNAME, Firstname format",
        "Privacy notice: 'À partir de 2021, conformément à la loi sur la protection des données personnelles, seul les mémorant-e-s qui ont donné leur consentement express figurent sur cette page'",
        "This means post-2021 listings are incomplete (only students who gave consent)",
        "Pre-2021 years likely have more complete listings"
      ]
    },
    "output_format": {
      "file": "unil_memoires_2024.csv",
      "location": "./data/test-1/"
    },
    "sample_entry": {
      "raw_text": "RIZET Océane: Objective Idealism\nJuin 2024\nDirecteur : Esfeld Michael",
      "type": "mastersthesis",
      "title": "Objective Idealism",
      "year": 2024,
      "authors": [{"given": "Océane", "family": "RIZET"}]
    },
    "data_quality": {
      "completeness": "Partial for 2021-2024 (consent-based), likely complete for 2010-2020",
      "structured_fields": ["author", "title", "year", "month", "supervisor"],
      "missing_fields": ["publisher", "doi", "url", "pages"],
      "privacy_constraint": "GDPR compliance - only consenting students listed post-2021"
    },
    "future_extractions": {
      "recommendation": "Extract all years (2010-2024) for complete dataset",
      "estimated_total": "300-400 mémoires across all years",
      "script_location": "philoch_bib_enhancer/adapters/raw_web_text/extractors/unil_memoires.py (currently only 2024)"
    }
  },

  "https://folia.unifr.ch/unifr/search/documents?customField2=Département%20de%20Philosophie": {
    "site_name": "FOLIA - University of Fribourg Philosophy Department Publications",
    "description": "Scholarly publications (articles, books, chapters) from University of Fribourg Philosophy Department via institutional repository",
    "expected_count": 83,
    "last_extraction": "2025-10-29",
    "site_characteristics": {
      "type": "javascript_spa",
      "structure": "Angular single-page application (SPA) using Invenio/SONAR framework",
      "javascript_required": true,
      "pagination": true,
      "items_per_page": 10,
      "api_available": false,
      "metadata_format": "JSON-LD + Dublin Core"
    },
    "extraction_method": {
      "approach": "Browser-assisted HTML download + individual record fetching",
      "steps": [
        "Download fully-rendered page from browser with size=83 parameter to get all results on one page",
        "Parse HTML to extract document URLs (pattern: /unifr/documents/[0-9]+)",
        "For each document URL, fetch individual record page via HTTP request",
        "Extract metadata from structured sources (JSON-LD schema.org + Dublin Core meta tags)",
        "JSON-LD provides: title, authors (name array), year (datePublished)",
        "Dublin Core meta tags provide: citation_author, citation_doi, citation_journal_title, citation_volume, citation_issue, citation_firstpage, citation_lastpage, citation_publisher",
        "Create RawWebTextBibitem objects with all extracted fields",
        "Process to CSV using process_raw_bibitems()"
      ],
      "challenges": [
        {
          "issue": "JavaScript-rendered content",
          "description": "Initial HTML contains only Angular app shell (<sonar-root>). Document list is loaded dynamically via JavaScript.",
          "solution": "User downloads fully-rendered page from browser after JavaScript execution. URL parameter size=83 ensures all results on one page."
        },
        {
          "issue": "No public API endpoint",
          "description": "Tried /api/documents, /api/unifr/documents, /unifr/api/documents - all returned 401 or 404.",
          "solution": "Extract document links from rendered HTML, then fetch each individual record page which contains rich metadata."
        },
        {
          "issue": "Initial extraction missing metadata",
          "description": "First version only extracted title and year from individual pages.",
          "solution": "Discovered JSON-LD and Dublin Core meta tags on individual record pages provide complete bibliographic metadata (authors, DOI, journal, volume, pages)."
        }
      ],
      "notes": [
        "FOLIA uses Invenio digital repository framework from CERN",
        "Individual record pages have excellent structured metadata",
        "JSON-LD schema.org markup is most reliable source",
        "Dublin Core citation meta tags provide journal-specific fields",
        "1-second delay between requests to be polite to server",
        "Full extraction takes ~2 minutes for 83 records"
      ]
    },
    "discovery_process": {
      "attempts": [
        "1. Direct HTTP request to search URL → Only Angular shell, no content",
        "2. Tried various API endpoints (/api/documents, etc.) → 401 or 404 errors",
        "3. Attempted pagination through multiple pages → Still no content (JavaScript required)",
        "4. User downloads rendered HTML with size=83 → SUCCESS! All 83 document links extracted",
        "5. Fetch individual record pages → Rich metadata in JSON-LD + Dublin Core"
      ],
      "key_insight": "Invenio/SONAR uses Angular SPA requiring JavaScript rendering. Individual record pages have excellent structured metadata for automated extraction."
    },
    "output_format": {
      "file": "folia_unifr_references.csv",
      "location": "./data/test-2/"
    },
    "sample_entry": {
      "raw_text": "Primitive colours in a physical world\nMoran, Alex\nSynthese 205\n2025",
      "type": "article",
      "title": "Primitive colours in a physical world",
      "year": 2025,
      "authors": [{"given": "Alex", "family": "Moran"}],
      "journal": "Synthese",
      "number": "205",
      "doi": "10.1007/s11229-025-05026-2",
      "url": "https://folia.unifr.ch/unifr/documents/331874"
    },
    "data_quality": {
      "completeness": "Excellent - institutional repository with curated metadata",
      "structured_fields": ["author", "title", "year", "journal", "volume", "issue", "pages", "doi", "publisher"],
      "coverage": {
        "authors": "83/83 (100%)",
        "doi": "46/83 (55%)",
        "journal": "73/83 (88%)",
        "years": "83/83 (100%)"
      },
      "metadata_source": "JSON-LD schema.org + Dublin Core citation meta tags",
      "year_range": "2000-2025"
    },
    "script_location": "philoch_bib_enhancer/adapters/raw_web_text/extractors/folia_unifr_philosophy.py"
  },

  "file:///*.bib": {
    "source_type": "BibTeX File",
    "description": "Extract bibliographic references from BibTeX (.bib) files",
    "last_extraction": "2025-10-30",
    "file_characteristics": {
      "format": "bibtex",
      "structure": "Structured BibTeX entries with @ entry types",
      "encoding": "UTF-8",
      "typical_entry_types": ["@article", "@book", "@incollection", "@thesis", "@phdthesis", "@mastersthesis", "@inproceedings"]
    },
    "extraction_method": {
      "approach": "Direct BibTeX parsing using Python regex and SDK conversion",
      "library": "Native Python (no bibtexparser dependency)",
      "steps": [
        "Read .bib file content",
        "Split into individual entries using regex pattern: r'\\n@'",
        "For each entry:",
        "  - Extract entry type from @type{...} pattern",
        "  - Extract fields using regex: field = {value} or field = \"value\"",
        "  - Parse authors: handle 'and' separators, 'Last, First' format",
        "  - Clean LaTeX formatting: remove {{}} double braces, {} single braces",
        "  - Handle special characters and accents",
        "  - Extract pages: handle formats like '123--456', '123-456', '123'",
        "  - Parse year: handle numeric years and special values like 'forthcoming'",
        "Create RawTextBibitem objects with all extracted metadata",
        "Convert to CSV using process_raw_bibitems() from SDK"
      ],
      "challenges": [
        {
          "issue": "LaTeX brace protection",
          "description": "BibTeX uses {{Text}} to protect capitalization. Titles had unnecessary braces like '{{Someone}}'",
          "solution": "Strip all curly braces iteratively: '{{Text}}' -> '{Text}' -> 'Text'"
        },
        {
          "issue": "Entry type format",
          "description": "Extracted 'article' but CSV writer adds '@' prefix for BibTeX compatibility",
          "solution": "This is correct behavior - '@article' is the proper BibTeX format in output CSV"
        },
        {
          "issue": "Publication state vs year",
          "description": "Values like 'forthcoming' and 'no date' mixed with numeric years",
          "solution": "Added separate 'pubstate' field to RawTextBibitem model. 'forthcoming' goes to pubstate, year stays as Optional[int]"
        }
      ],
      "notes": [
        "BibTeX files are already structured, so parsing is straightforward",
        "Main challenge is cleaning LaTeX formatting for plain text output",
        "SDK's converter handles transformation to BibItem format",
        "Output CSV maintains BibTeX compatibility with @ prefixes"
      ]
    },
    "output_format": {
      "method": "process_raw_bibitems()",
      "format": "CSV with BibTeX-compatible fields"
    },
    "sample_entry": {
      "raw_text": "@article{bagley_loving_2015,\n  title = {Loving {{Someone}} in {{Particular}}},\n  author = {Bagley, Benjamin},\n  year = {2015},\n  journal = {Ethics},\n  volume = {125},\n  number = {2},\n  pages = {477--507},\n  doi = {10.1086/678481}\n}",
      "type": "article",
      "title": "Loving Someone in Particular",
      "year": 2015,
      "authors": [{"given": "Benjamin", "family": "Bagley"}],
      "journal": "Ethics",
      "volume": "125",
      "issue_number": "2",
      "start_page": "477",
      "end_page": "507",
      "doi": "10.1086/678481"
    },
    "data_quality": {
      "completeness": "Excellent - BibTeX is structured format",
      "common_fields": ["entry_type", "title", "author", "year", "journal", "volume", "number", "pages", "publisher", "doi"],
      "cleaning_applied": [
        "LaTeX brace removal ({{}} and {})",
        "Page range normalization (-- to --)",
        "Author name parsing (handles 'and' separators)",
        "DOI cleaning (remove trailing punctuation)"
      ]
    },
    "script_location": "philoch_bib_enhancer/adapters/raw_text/extractors/extract_bibtex.py",
    "usage": "python extract_bibtex.py <input.bib> <output.csv>",
    "example_files": [
      "data/biblio/biblio-training/new-ones-for-Claude/blumson-joaquin.bib (107 entries)"
    ]
  },

  "file:///*.pdf": {
    "source_type": "PDF File with Bibliography",
    "description": "Extract bibliographic references from academic PDFs containing reference sections",
    "last_extraction": "2025-10-30",
    "file_characteristics": {
      "format": "pdf",
      "typical_sources": "Academic papers, theses, dissertations with bibliography sections",
      "encoding": "UTF-8 (after extraction)",
      "structure": "Unstructured text with 'References' or 'Bibliography' section"
    },
    "extraction_method": {
      "approach": "PDF text extraction + bibliography section parsing",
      "library": "pypdf",
      "steps": [
        "Extract text from PDF using pypdf library",
        "Identify bibliography section by looking for markers: 'References', 'Bibliography', 'Works Cited', 'Literature'",
        "Parse individual entries:",
        "  - Detect entry boundaries: lines starting with uppercase letter or em-dash + year pattern",
        "  - Extract year from (YYYY) pattern",
        "  - Extract title from quoted text or after year",
        "  - Parse authors: handle 'and' separators, 'Last, First' format, em-dash for 'same author'",
        "  - Determine entry type: article (has journal), book, incollection (has 'In:')",
        "  - Extract journal from 'In: Journal vol.issue' pattern",
        "  - Extract pages from 'pp. start--end' pattern",
        "  - Extract DOI from 'doi: ...' pattern",
        "  - Clean OCR artifacts and line-break hyphens",
        "Create RawTextBibitem objects",
        "Convert to CSV using process_raw_bibitems() with proper SDK method"
      ],
      "challenges": [
        {
          "issue": "Curly/typographic quotes",
          "description": "PDF text had curly quotes (U+201C U+201D) instead of straight quotes, regex didn't match",
          "solution": "Use Unicode escapes in regex: r'[\\\"\\\\u201C]([^\\\"\\\\u201D]+)[\\\"\\\\u201D]' to handle both types"
        },
        {
          "issue": "Line-break hyphens",
          "description": "PDF line breaks created broken words: 'Understand- ing', 'Univer- sity'",
          "solution": "Regex to remove hyphen+space pattern: r'([a-z])-\\s+([a-z])' -> r'\\1\\2'. Preserves real compounds like 'well-known'"
        },
        {
          "issue": "OCR artifacts with accents",
          "description": "Accented characters split: 'Alchourr´ on' instead of 'Alchourrón', 'G¨ ardenfors' instead of 'Gärdenfors'",
          "solution": "Replace OCR patterns: '´ o' -> 'ó', '¨ a' -> 'ä', etc. for common accented characters"
        },
        {
          "issue": "DOI trailing punctuation",
          "description": "DOIs had trailing dots: '10.1007/s10892-005-3508-y.'",
          "solution": "Strip trailing punctuation from DOI: doi.rstrip('.,')"
        },
        {
          "issue": "Unnecessary quotes in output",
          "description": "Titles appeared with quotes in CSV even after stripping during parsing",
          "solution": "The issue was curly quotes not being detected. Once regex was fixed to handle Unicode quotes (\\u201C, \\u201D), titles were properly cleaned"
        }
      ],
      "notes": [
        "PDF extraction quality depends on PDF quality (OCR vs native text)",
        "Bibliography format varies by citation style (APA, Chicago, MLA, etc.)",
        "Current parser handles common academic formats",
        "Em-dash (—) in bibliography means 'same author as previous entry'",
        "Line joining during parsing requires careful handling to preserve/remove hyphens correctly"
      ]
    },
    "text_cleaning": {
      "ocr_fixes": [
        "´ o -> ó (acute accent)",
        "¨ a -> ä (umlaut)",
        "` e -> è (grave accent)",
        "ˆ o -> ô (circumflex)"
      ],
      "line_break_hyphens": {
        "pattern": "word- continuation",
        "solution": "Remove hyphen+space when followed by lowercase letter",
        "preserves": "Real compounds like 'well-known', 'meta-analysis', 'Ben-Zeev'"
      },
      "quote_handling": {
        "straight_quotes": "U+0022",
        "curly_left": "U+201C",
        "curly_right": "U+201D",
        "regex_pattern": "[\\\"\\\\u201C]([^\\\"\\\\u201D]+)[\\\"\\\\u201D]"
      }
    },
    "output_format": {
      "method": "process_raw_bibitems() via temporary file + append",
      "format": "CSV appended to existing file (preserves header)"
    },
    "sample_entry": {
      "raw_text": "Arras, John D. (2007). The Way We Reason Now: Reflective Equilibrium in Bioethics. In: The Oxford Handbook of Bioethics. Ed. by Bonnie Steinbock. Oxford University Press, pp. 46-71. doi: 10.1093/oxfordhb/9780199562411.003.0003.",
      "type": "incollection",
      "title": "The Way We Reason Now: Reflective Equilibrium in Bioethics",
      "year": 2007,
      "authors": [{"given": "John D", "family": "Arras"}],
      "start_page": "46",
      "end_page": "71",
      "doi": "10.1093/oxfordhb/9780199562411.003.0003"
    },
    "data_quality": {
      "completeness": "Good for structured bibliographies",
      "accuracy": "Depends on PDF text extraction quality and OCR",
      "common_fields": ["type", "title", "authors", "year", "journal", "pages", "doi", "publisher"],
      "cleaning_applied": [
        "Curly quote removal",
        "Line-break hyphen fixing",
        "OCR artifact correction",
        "DOI punctuation cleanup"
      ],
      "challenges": "Varies by citation style, PDF quality, and bibliography formatting"
    },
    "script_location": "philoch_bib_enhancer/adapters/raw_text/extractors/parse_pdf_bibliography.py",
    "helper_script": "philoch_bib_enhancer/adapters/raw_text/extractors/extract_pdf_text.py (for initial text extraction)",
    "usage": "python parse_pdf_bibliography.py",
    "example_files": [
      "data/biblio/biblio-training/new-ones-for-Claude/freivogel.pdf (37 references extracted)"
    ]
  }
}
